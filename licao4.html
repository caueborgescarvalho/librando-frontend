<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="shortcut icon" type="image/x-icon" href="img/icone.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Librando - Aprender Libras</title>
  
  <!-- Fonte personalizada -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+Tamma+2:wght@400;700&display=swap" rel="stylesheet">
  
  <!-- Seu CSS -->
  <link rel="stylesheet" href="css/estiloAtividades.css">
</head>
<body>
  <div class="container">
    <!-- Barra de progresso -->
    <div class="progress-bar">
      <div class="progress">
        <div class="reflexo"></div>
      </div>
    </div>

    <!-- Conteúdo principal -->
    <div class="main-content">
      <!-- Seção do mascote -->
      <div class="mascot-section">
        <img src="img/LiliSentada.png" alt="Mascote" class="elephant">
        <div class="speech-bubble"> Retomando o alfabeto: </div>
      </div>

      <!-- Título -->
      <h2>Conheça novas letras:</h2>

      <!-- Cartão da letra -->
      <div class="letter-card">
        <button id="prevButton" class="arrow-btn">‹</button>
        <img id="letterImage" class="container-zoom-permanente" src="gestos/j.JPG" alt="Letra J">
        <button id="nextButton" class="arrow-btn">›</button>
      </div>

      <!-- Nome da letra -->
      <p id="letterName" class="letter-name">"J"</p>
    </div>

    <!-- Rodapé com pergunta -->
    <div class="footer">
      <p class="question">
        COMO VOCÊ SE CHAMA?
        <button id="finalbuton" class="arrow-btn" style="display: none;" onclick="window.location.href='licao4-2.html'">›</button>
      </p>
    </div>
  </div>

  <!-- Script JavaScript -->
  <script>
    // === Dados ===
    // Array com todas as letras e dados, em ordem.
    const letters = [
      { letter: "N", img: "gestos/n.mp4", name: "'N'" },
      { letter: "O", img: "gestos/o.mp4", name: "'O'" },
      { letter: "P", img: "gestos/p.mp4", name: "'P'" },
      { letter: "Q", img: "gestos/q.mp4", name: "'Q'" },

      { letter: "1", img: "gestos/tdbem.mp4", name: "'Tudo bem?'" },
      { letter: "2", img: "gestos/meajuda.mp4", name: "'Precisa de ajuda?'" },
      { letter: "3", img: "gestos/teajudo.mp4", name: "'Pode me ajudar?'" },
      //{ letter: "4", img: "gestos/m.JPG", name: "'Desculpa'" }
    ];

    let currentIndex = 0;
    // Variável de controle para saber se já chegamos na letra 'J'.
    let reachedJ = false;

    // === Elementos ===
    const letterImage = document.getElementById("letterImage");
    const letterName = document.getElementById("letterName");
    const nextButton = document.getElementById("nextButton");
    const prevButton = document.getElementById("prevButton");
    const progressBar = document.querySelector(".progress");

    const speech = document.querySelector(".speech-bubble");
    const titleEl = document.querySelector("h2");
    const questionEl = document.querySelector(".question");

    // Guardamos os textos atuais como “padrão”
    const defaultSpeech = speech ? speech.textContent : "";
    const defaultTitle = titleEl ? titleEl.textContent : "";
    const questionTextNode = questionEl
        ? Array.from(questionEl.childNodes).find(n => n.nodeType === Node.TEXT_NODE)
        : null;
    const defaultQuestion = questionTextNode ? questionTextNode.textContent.trim() : "";

    // Textos alvo quando atingir "J"
    const JTexts = {
        speech: "Aprenda novos sinais!",
        title: "Sinais essenciais:",
        question: "SINAIS BÁSICOS"
    };

    // Aplica os textos (com transição suave)
    function applyTexts() {
        const elements = [
            { el: speech, newText: reachedJ ? JTexts.speech : defaultSpeech },
            { el: titleEl, newText: reachedJ ? JTexts.title : defaultTitle },
            { el: questionTextNode, newText: reachedJ ? JTexts.question + " " : defaultQuestion + " " }
        ];

        elements.forEach(item => {
            if (!item.el) return;

            if (item.el.nodeType === Node.TEXT_NODE) {
                const parent = item.el.parentElement;
                parent.classList.add("fade-text");
                parent.classList.add("fade-out");

                setTimeout(() => {
                    item.el.textContent = item.newText;
                    parent.classList.remove("fade-out");
                }, 400);
            } else {
                item.el.classList.add("fade-text");
                item.el.classList.add("fade-out");

                setTimeout(() => {
                    item.el.textContent = item.newText;
                    item.el.classList.remove("fade-out");
                }, 400);
            }
        });
    }

    // Atualiza passo (imagem, nome, barra e textos)
    function updateStep() {
        const item = letters[currentIndex];

        // Seleciona a moldura
        const letterCard = document.querySelector(".letter-card");

        // Remove vídeo antigo se existir
        let oldVideo = document.getElementById("letterVideo");
        if (oldVideo) oldVideo.remove();

        if (item.img.endsWith(".mp4") || item.img.endsWith(".webm")) {
            letterImage.style.display = "none";
            const video = document.createElement("video");
            video.id = "letterVideo";
            video.src = item.img;
            video.autoplay = true;
            video.loop = true;
            video.muted = true;
            video.playsInline = true;
            video.style.width = "220px";
            video.style.height = "220px";
            video.style.borderRadius = "15px";
            video.style.objectFit = "cover";
            video.style.boxShadow = "0px 4px 8px rgba(0,0,0,0.1)";
            video.style.border = "4px solid #75429E";

            letterCard.insertBefore(video, nextButton);
        } else {
            letterImage.style.display = "block";
            letterImage.src = item.img;
        }

        if (letterName) letterName.textContent = item.name;
        if (progressBar) progressBar.style.width = ((currentIndex + 1) / letters.length * 100) + "%";
        
        // ======================= LINHA CORRIGIDA =======================
        // Verifica se o índice atual é 4 (posição da letra 'J') ou maior.
        // Assim, o texto modificado permanece para 'K', 'L', 'M', etc.
        reachedJ = (currentIndex >= 4);
        // ===============================================================

        applyTexts();

        // === Controle do botão final ===
        const finalButton = document.getElementById("finalbuton");
        if (currentIndex === letters.length - 1) {
            finalButton.style.display = "inline-block";
        } else {
            finalButton.style.display = "none";
        }
    }

    // Clique do botão “próximo”
if (nextButton) {
  nextButton.addEventListener("click", () => {
    // Se não estiver no último item, avança
    if (currentIndex < letters.length - 1) {
      currentIndex++;
      updateStep();
    }
  });
}

// Clique do botão “voltar”
if (prevButton) {
  prevButton.addEventListener("click", () => {
    // Se não estiver no primeiro item, volta
    if (currentIndex > 0) {
      currentIndex--;
      updateStep();
    }
  });
}

// Garante que os textos corretos estejam aplicados no carregamento
applyTexts();

// Adiciona os outros eventos que estavam no JS da lição 1 para consistência
const letterCard = document.querySelector(".letter-card");

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowRight') nextButton?.click();
  if (e.key === 'ArrowLeft') prevButton?.click();
});

letterCard?.addEventListener('click', e => {
  if (e.target.tagName !== 'BUTTON' && e.target.parentElement.tagName !== 'BUTTON') {
    nextButton?.click();
  }
});

// Inicializa o primeiro passo
updateStep();
</script>
</body>
</html>
