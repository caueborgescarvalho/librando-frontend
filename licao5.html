<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Librando - Aprender Libras</title>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+Tamma+2:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/estiloAtividades.css">
  <link rel="shortcut icon" type="image/x-icon" href="img/icone.png">
</head>
<body>
  <div class="container">
    <div class="progress-bar">
      <div class="progress">
        <div class="reflexo"></div>
      </div>
    </div>

    <div class="main-content">
      <div class="mascot-section">
        <img src="img/liliSentada.png" alt="Mascote" class="elephant">
        <div class="speech-bubble">Vamos aprender novos sinais?</div>
      </div>

      <h2>Conheça algumas letras:</h2>

      <div class="letter-card">
        <button id="prevButton" class="arrow-btn">‹</button>
        <img id="letterImage" class="container-zoom-permanente" src="gestos/a.JPG" alt="Letra A">
        <button id="nextButton" class="arrow-btn">›</button>
      </div>
      <p id="letterName" class="letter-name">"A"</p>
    </div>

    <div class="footer">
      <p class="question">
        COMO VOCÊ SE CHAMA?
        <button id="finalbuton" class="arrow-btn" onclick="window.location.href='licao5-2.html'">›</button>
      </p>
    </div>
  </div>

  <script>
// === Dados ===
const letters = [
    { letter: 'R', img: 'gestos/r.mp4', name: "'R'" },
    { letter: 'S', img: 'gestos/s.mp4', name: "'S'" },
    { letter: 'T', img: 'gestos/t.mp4', name: "'T'" },
    { letter: 'U', img: 'gestos/u.mp4', name: "'U'" },
    { letter: 'V', img: 'gestos/v.mp4', name: "'V'" },
    { letter: 'casa', img: 'gestos/casa.mp4', name: 'Casa' },
    { letter: 'escola', img: 'gestos/escola.mp4', name: "'Escola'" },
    { letter: 'comer', img: 'gestos/comer.mp4', name: "'Comer'" },
    { letter: 'beber', img: 'gestos/beber.mp4', name: "'Beber'" },
    { letter: 'andar', img: 'gestos/andar.mp4', name: "'Andar'" },
];

let currentIndex = 0;
// Variável que controla a mudança de texto. Será 'true' após passar da letra 'V'.
let reachedContentChange = false;

// === Elementos ===
const letterImage = document.getElementById('letterImage');
const letterName = document.getElementById('letterName');
const nextButton = document.getElementById('nextButton');
const prevButton = document.getElementById('prevButton');
const progressBar = document.querySelector('.progress');
const letterCard = document.querySelector('.letter-card');
const finalButton = document.getElementById('finalbuton');

// Elementos de texto dinâmico
const speech = document.querySelector('.speech-bubble');
const titleEl = document.querySelector('h2');
const questionEl = document.querySelector('.question');

// Guarda os textos originais da página
const defaultSpeech = speech?.textContent || '';
const defaultTitle = titleEl?.textContent || '';
const questionTextNode = questionEl ? Array.from(questionEl.childNodes).find(n => n.nodeType === Node.TEXT_NODE) : null;
const defaultQuestion = questionTextNode ? questionTextNode.textContent.trim() : '';

// Define os novos textos que aparecerão no meio da lição
const newTexts = {
    speech: 'Muito bem! Que tal aprender alguns sinais para ações do dia a dia?',
    title: 'Conheça alguns sinais essenciais:',
    question: 'AÇÕES COTIDIANAS',
};

// === Funções ===

/**
 * Aplica os textos (originais ou novos) com um efeito de fade.
 */
function applyTexts() {
    // Define qual conjunto de textos usar com base na variável de controle
    const texts = reachedContentChange ? newTexts : { speech: defaultSpeech, title: defaultTitle, question: defaultQuestion };
    
    // Lista de elementos e seus novos textos
    const elementsToUpdate = [
        { el: speech, newText: texts.speech },
        { el: titleEl, newText: texts.title },
        { el: questionTextNode, newText: `${texts.question} ` },
    ];

    elementsToUpdate.forEach(({ el, newText }) => {
        if (!el) return;

        const parent = el.nodeType === Node.TEXT_NODE ? el.parentElement : el;
        
        // Evita reiniciar a animação se o texto já for o correto
        if (el.textContent.trim() === newText.trim()) return;

        parent.classList.add('fade-text', 'fade-out');
        setTimeout(() => {
            el.textContent = newText;
            parent.classList.remove('fade-out');
        }, 400);
    });
}

/**
 * Atualiza o conteúdo do card (imagem/vídeo, nome, barra de progresso e textos).
 */
function updateStep() {
    const item = letters[currentIndex];

    // Remove qualquer vídeo que já exista
    const oldVideo = document.getElementById('letterVideo');
    if (oldVideo) oldVideo.remove();

    // Verifica se o item é um vídeo ou uma imagem
    if (item.img.endsWith('.mp4') || item.img.endsWith('.webm')) {
        letterImage.style.display = 'none';

        const video = document.createElement('video');
        video.id = 'letterVideo';
        video.src = item.img;
        video.autoplay = true;
        video.loop = true;
        video.muted = true;
        video.playsInline = true; // Essencial para autoplay em alguns celulares
        video.style.width = '220px';
        video.style.height = '220px';
        video.style.borderRadius = '15px';
        video.style.objectFit = 'cover';
        video.style.boxShadow = '0px 4px 8px rgba(0,0,0,0.1)';
        video.style.border = '4px solid #75429E';

        letterCard.insertBefore(video, nextButton);
    } else {
        letterImage.style.display = 'block';
        letterImage.src = item.img;
    }

    // Atualiza o nome da letra/sinal
    if (letterName) letterName.textContent = item.name;
    
    // Atualiza a barra de progresso
    if (progressBar) progressBar.style.width = `${((currentIndex + 1) / letters.length) * 100}%`;

    // **LÓGICA CORRIGIDA**: Verifica se o índice atual já passou do ponto de mudança (após a letra 'V', que é o índice 4)
    reachedContentChange = currentIndex > 4;
    applyTexts();

    // Mostra ou esconde o botão para ir para a próxima fase
    if (finalButton) {
        finalButton.style.display = currentIndex === letters.length - 1 ? 'inline-block' : 'none';
    }
}

// === Eventos ===

// Botão "Próximo"
nextButton?.addEventListener('click', () => {
    if (currentIndex < letters.length - 1) {
        currentIndex++;
        updateStep();
    }
});

// Botão "Voltar"
prevButton?.addEventListener('click', () => {
    if (currentIndex > 0) {
        currentIndex--;
        updateStep();
    }
});

// Navegação pelo teclado (Setas Direita e Esquerda)
document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') nextButton?.click();
    if (e.key === 'ArrowLeft') prevButton?.click();
});

// Clicar no card para avançar (evitando o clique nos botões)
letterCard?.addEventListener('click', (e) => {
    if (e.target.tagName !== 'BUTTON' && e.target.id !== 'letterVideo') {
        nextButton?.click();
    }
});

// Inicia a aplicação
updateStep();
</script>
</body>
</html>